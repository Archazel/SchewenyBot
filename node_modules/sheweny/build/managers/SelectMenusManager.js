"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SelectMenusManager = void 0;
const collection_data_1 = require("collection-data");
const path_1 = require("path");
const readDirFiles_1 = require("../utils/readDirFiles");
/**
 * Manager for Select Menus
 */
class SelectMenusManager {
    /**
     * Constructor to manage select menus
     * @param {ShewenyClient} client Client framework
     * @param {string} directory Directory of the select menus folder
     * @param {boolean} [loadAll] If the select menus are loaded during bot launch
     */
    constructor(client, directory, loadAll) {
        if (!client)
            throw new TypeError("Client must be provided.");
        if (!directory)
            throw new TypeError("Directory must be provided.");
        this.client = client;
        this.directory = directory;
        if (loadAll)
            this.loadAll();
        client.handlers.selectMenus = this;
    }
    /**
     * Load all select menus in collection
     * @returns {Promise<Collection<string[], SelectMenu>>}
     */
    async loadAll() {
        const selectMenus = new collection_data_1.Collection();
        const baseDir = path_1.join(require.main.path, this.directory);
        const selectMenusPaths = await readDirFiles_1.readDirAndPush(baseDir);
        for (const selectMenuPath of selectMenusPaths) {
            const selectMenuImport = await Promise.resolve().then(() => require(selectMenuPath));
            const key = Object.keys(selectMenuImport)[0];
            const SelectMenu = selectMenuImport[key];
            if (!SelectMenu)
                continue;
            const instance = new SelectMenu(this.client);
            if (!instance.customId)
                continue;
            instance.path = selectMenuPath;
            selectMenus.set(instance.customId, instance);
        }
        this.client.collections.selectMenus = selectMenus;
        this.selectMenus = selectMenus;
        return selectMenus;
    }
}
exports.SelectMenusManager = SelectMenusManager;
